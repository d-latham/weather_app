@page "/astronomy"
@inject HttpClient Http

<PageTitle>Astronomy Stuff</PageTitle>

<h1>Astronomy Data</h1>

<form class="location-form">
  <label for="location-input">Location:</label>
  <input type="text" id="location-input" name="location-input">

  <label for="sunrise-input">Sunrise:</label>
  <input type="radio" id="sunrise-input" name="sunrise-sunset" value="sunrise" checked>

  <label for="sunset-input">Sunset:</label>
  <input type="radio" id="sunset-input" name="sunrise-sunset" value="sunset">

  <button type="submit" class="submit-button">Submit</button>
</form>

<div class="sunrise-sunset-times"></div>

@code {
    private string? sunriseTime;
    private string? sunsetTime;

    protected override void OnInitialized()
    {
        sunriseTime = "";
        sunsetTime = "";
    }

    private async Task OnFormSubmit()
    {
        var locationInput = document.GetElementById("location-input") as HTMLInputElement;
        var selectedRadio = document.QuerySelector("input[name='sunrise-sunset']:checked") as HTMLInputElement;

        if (locationInput != null && !string.IsNullOrWhiteSpace(locationInput.Value))
        {
            var location = locationInput.Value;

            var response = await Http.GetAsync($"https://api.sunrise-sunset.org/json?formatted=0&lat={location}&lng={location}&date=today");

            if (response.IsSuccessStatusCode)
            {
                var content = await response.Content.ReadAsStringAsync();
                var result = JsonSerializer.Deserialize<SunriseSunsetResponse>(content);

                if (result != null)
                {
                    sunriseTime = result.Results.Sunrise.ToLocalTime().ToString("h:mm tt");
                    sunsetTime = result.Results.Sunset.ToLocalTime().ToString("h:mm tt");
                }
            }
        }
    }

    private class SunriseSunsetResponse
    {
        public SunriseSunsetResults Results { get; set; }
    }

    private class SunriseSunsetResults
    {
        public DateTime Sunrise { get; set; }
        public DateTime Sunset { get; set; }
    }
}
